# fal2muc
日本ファルコムのゲームのサウンドデータをMUCOM88形式のMMLに変換するソフトウェアです。

## 概要
ソーサリアンに代表されるFM音源時代の日本ファルコムのゲームのサウンドデータを
[MUCOM88](https://www.ancient.co.jp/~mucom88/)のMML形式に変換します。
変換したデータは、[MUCOM88 Windows](https://onitama.tv/mucom88/)で演奏可能なほか、
N88-BASIC形式に変換すれば、PC-88実機やエミュレータで動作するMUCOM88でも演奏可能になります。

ソーサリアン以降の、PC-88シリーズ、PC-98シリーズ、X1シリーズの多くのタイトルに対応しています。

簡単なプログラムですので、
同等の機能を備えたほかのサウンドドライバ向けへの移植も容易です。

## 動作環境
* 一般的なC言語で記述されています。
* コマンドライン実行向けのプログラムです。
* Windowsのmsys2のMinGW(gcc)環境でビルドと実行を確認しています。

## ビルド
```sh
git clone https://github.com/hyano/fal2muc.git
cd fal2muc
make
```

## 使い方
### 基本的な使い方
```sh
./fal2muc -o 出力ファイル データファイル
```

### コマンドラインオプション
実行時に以下のオプションを指定することができます。

  * <b>-h</b>

    ヘルプを表示して終了します。

  * <b>-v</b>

    デバッグ用の出力を有効にします。
    出力されたデータはコンパイルできません。

  * <b>-w</b>

    警告を無視して強制的に変換します。
    一部のデータに存在するバグを回避するためのオプションです。

  * <b>-o</b> `FILE`

    出力先のファイル名を指定します。
    指定がない場合は、標準出力に出力します。

  * <b>-m</b> `VERSION`

    `#mucom88`タグの内容を指定します。

  * <b>-t</b> `TITLE`

    `#title`タグの内容を指定します。

  * <b>-a</b> `AUTHOR`

    `#author`タグの内容を指定します。

  * <b>-c</b> `COMPOSER`

    `#composer`タグの内容を指定します。

  * <b>-d</b> `DATE`

    `#date`タグの内容を指定します。

  * <b>-C</b> `COMMENT`

    `#comment`タグの内容を指定します。

  * <b>-F</b> `FORMAT`

    入力データのフォーマットを指定します。
    指定しない場合はデータ形式をヘッダ部分から推定します。

    以下の形式を指定することができます。

    | 名前    | 概要                    | 補足                          |
    |:--------|:------------------------|:------------------------------|
    | opn     | PC-88/PC-98 OPN対応曲   |                               |
    | opna    | PC-88/PC-98 OPNA対応曲  |                               |
    | va      | PC-88VA OPNA対応曲      | ソーサリアンPC-88VA専用版向け |
    | mono    | PC-88/PC-98 OPNA対応曲  | OPN搭載機向けのデータを出力   |
    | x1opm   | X1用データ(OPM/PSG結合) | OPM搭載機向けデータを出力     |
    | x1psg   | X1用データ(OPM/PSG結合) | OPM非搭載機向けデータを出力   |

    `opna`相当のOPNA対応のデータを、OPN機種向けのMMLに変換する場合は`mono`の明示的な指定が必要です。
    ソーサリアンX1版のデータを、PSG向けのMMLに変換する場合は`x1psg`の明示的な指定が必要です。


### コマンドラインの例
#### PC-8801mkIISR以降版ソーサリアンのオープニングをMMLに変換
```sh
COMMENT="[PC-8801] SORCERIAN - Dragon Slayer V - (基本シナリオ)"
COMPOSER="古代祐三"
AUTHOR="日本ファルコム"
DATE="1987/12/20"
./fal2muc -d "$DATE" -a "$AUTHOR" -C "$COMMENT" -c "$COMPOSER" -t "オープニング" -o muc/SS000.muc data/SS000
```

#### X1(PSG)版ソーサリアンのオープニングをMMLに変換
```sh
COMMENT="[X1] SORCERIAN - Dragon Slayer V - (基本シナリオ)(PSG)"
COMPOSER="古代祐三"
AUTHOR="日本ファルコム"
DATE="1988/05/20"
./fal2muc -F x1psg -d "$DATE" -a "$AUTHOR" -C "$COMMENT" -c "$COMPOSER" -t "オープニング" -o muc/SS039.muc data/SS039
```

### N88-BASIC形式への変換
同梱の`txt2bas`を使用することにより、テキストファイルをN88-BASICのREM文形式に変換できます。
変換後のファイルをディスクイメージに書き戻せば、PC-88実機やエミュレータで動作するMUCOM88でも演奏可能です。
`txt2bas`は標準入力からテキストを読み込み、
コマンドラインで指定したファイルにN88-BASIC形式で出力します。

#### PC-8801mkIISR以降版ソーサリアンのオープニングをN88-BASIC形式に変換
```sh
./fal2muc data/SS000 | ./txt2bas bas/ss000
```

## 注意事項
* サウンドデータは各自で入手してください。
* 本ソフトウェアで変換したデータを不正に利用しないでください。
* 限られたデータと出力オプションでのみ動作確認しています。
* 本ソフトウェアは、エラー処理を実装しておりません。
  想定外のデータを入力すると、誤動作します。
* ファルコムのサウンドドライバとMUCOM88の機能やデータ形式は非常によく似ていますが、
  実装は異なるため、同じ鳴り方をしない部分があります。

## ライセンス
このソフトウェアは[MITライセンス](LICENSE)にて提供しています。  
Copyright (c) 2019 Hirokuni Yano
